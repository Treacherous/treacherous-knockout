!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Treacherous=t():e.Treacherous=t()}(window,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(i,s,function(t){return e[t]}.bind(null,s));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(e,t){e.exports=ko},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getValidationGroup=function(t){return t[e.validationGroup]},e.getViewOptions=function(t){return t[e.viewOptions]},e.getViewStrategy=function(t){return t[e.viewStrategy]||"inline"},e.getCurrentPropertyPath=function(t,r){var i="";if(r.$index){var s="$data"==t||"$rawData"==t?"":t;i=r.$parentContext&&r.$parentContext[e.validationPropertyPathBindingName]?r.$parentContext[e.validationPropertyPathBindingName]+"["+r.$index()+"]"+s:"["+r.$index()+"]"+s}else i=t;return i},e.validationPropertyBindingName="validationProperty",e.validationPropertyPathBindingName="validationPropertyPath",e.validationGroup="validationGroup",e.viewOptions="viewOptions",e.viewStrategy="viewStrategy",e}();t.BindingHelper=i},function(e,t,r){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}i(r(14)),i(r(7))},function(e,t,r){var i=r(13);t.PropertyResolver=i.PropertyResolver},function(e,t,r){"use strict";r.r(t);class i{constructor(){this.strategies={},this.registerStrategy=(e=>{this.strategies[e.strategyName]=e}),this.unregisterStrategy=(e=>{delete this.strategies[e.strategyName]}),this.getStrategyNamed=(e=>this.strategies[e]||null),this.hasStrategyNamed=(e=>null!=this.getStrategyNamed(e))}}class s{}s.hasClass=((e,t)=>e.classList?e.classList.contains(t):!!e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))),s.addClass=((e,t)=>{e.classList?e.classList.add(t):s.hasClass(e,t)||(e.errorClassName+=" "+t)}),s.removeClass=((e,t)=>{if(e.classList)e.classList.remove(t);else if(s.hasClass(e,t)){const r=new RegExp(`(\\s|^)${t}(\\s|$)`);e.errorClassName=e.className.replace(r," ")}});class n{constructor(){this.getElementValidatorId=(e=>(e.getAttribute("id")||e.setAttribute("id","unique-"+n.currentCount++),e.getAttribute("id")+"-error-container")),this.createErrorElement=((e,t)=>{let r=this.getElementValidatorId(t),i=document.createElement("div");return i.id=r,i.className="validation-error-container",i.textContent=e,t.parentElement.appendChild(i),i}),this.removeErrorElement=function(e){let t=this.getElementValidatorId(e),r=document.getElementById(t);r&&r.parentElement.removeChild(r)},this.addElementError=function(e,t){let r=this.getElementValidatorId(t);return document.getElementById(r)?(this.removeErrorElement(t),this.createErrorElement(e,t)):this.createErrorElement(e,t)}}}n.currentCount=1;class o{constructor(e=new n){this.inlineHandler=e,this.strategyName="inline"}propertyBecomeValid(e){s.removeClass(e,"invalid"),s.addClass(e,"valid"),this.inlineHandler.removeErrorElement(e)}propertyBecomeInvalid(e,t){s.removeClass(e,"valid"),s.addClass(e,"invalid"),this.inlineHandler.addElementError(t,e)}}class a{constructor(){this.summaries={},this.registerSummary=(e=>{this.summaries[e.summaryName]=e}),this.unregisterSummary=(e=>{delete this.summaries[e.summaryName]}),this.getSummaryNamed=(e=>this.summaries[e]||null),this.hasSummaryNamed=(e=>null!=this.getSummaryNamed(e))}}class l{constructor(){this.applyContainerClass=(e=>{s.addClass(e,l.containerClassName)}),this.getPropertyElementName=(e=>{let t=e.replace(/[\[\].]/g,"-");return`${l.elementIdFormat}${t}`}),this.getPropertyErrorElement=((e,t)=>{let r=this.getPropertyElementName(t);return e.querySelector(`#${r}`)}),this.createPropertyErrorElement=((e,t,r)=>{let i=this.getPropertyElementName(r),s=document.createElement("div");return s.id=i,s.className=l.errorClassName,s.textContent=e,s.setAttribute("property-route",r),t.appendChild(s),s}),this.removePropertyErrorElement=((e,t)=>{let r=this.getPropertyErrorElement(e,t);r&&e.removeChild(r)})}}l.elementIdFormat="summary-error-for-",l.errorClassName="summary-error",l.containerClassName="validation-summary-container";class u{constructor(e=new l){this.summaryHandler=e,this.summaryName="default"}setupContainer(e){this.summaryHandler.applyContainerClass(e)}propertyBecomeValid(e,t){this.summaryHandler.removePropertyErrorElement(e,t)}propertyBecomeInvalid(e,t,r){let i=`${r} - ${t}`;this.summaryHandler.removePropertyErrorElement(e,r),this.summaryHandler.createPropertyErrorElement(i,e,r)}}var h=new i;h.registerStrategy(new o);var c,d=new a;d.registerSummary(new u);class p{static literalToJson(e){let t,r=`{ ${e} }`.replace(p.jsLiteralRegex,'$1"$2":');try{t=JSON.parse(r)}catch(t){console.warn(`unable to process literal: ${e}`,t)}return t||{}}}p.jsLiteralRegex=/({|,)(?:\s*)(?:')?([A-Za-z_$\.][A-Za-z0-9_ \-\.$]*)(?:')?(?:\s*):/g;class y{static getPropertyRouteFrom(e){return e.getAttribute(y.ValidatePropertyAttributeName)}static getViewStrategyFrom(e){return e.getAttribute(y.ViewStrategyAttributeName)}static getViewOptionsFrom(e){let t=e.getAttribute(y.ViewOptionsAttributeName);if(t)return p.literalToJson(t)}static getSummaryStrategyFrom(e){return e.getAttribute(y.ViewSummaryStrategyAttributeName)}static getSummaryOptionsFrom(e){let t=e.getAttribute(y.SummaryOptionsAttributeName);if(t)return p.literalToJson(t)}}y.ValidatePropertyAttributeName="validate-property",y.ViewStrategyAttributeName="view-strategy",y.ViewOptionsAttributeName="view-options",y.ViewSummaryStrategyAttributeName="view-summary-strategy",y.SummaryOptionsAttributeName="summary-options",function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid"}(c||(c={})),r.d(t,"viewStrategyRegistry",function(){return h}),r.d(t,"viewSummaryRegistry",function(){return d}),r.d(t,"ClassHelper",function(){return s}),r.d(t,"ElementHelper",function(){return y}),r.d(t,"JsLiteralHelper",function(){return p}),r.d(t,"ValidationState",function(){return c}),r.d(t,"ViewStrategyRegistry",function(){return i}),r.d(t,"ViewSummaryRegistry",function(){return a}),r.d(t,"DefaultViewSummary",function(){return u}),r.d(t,"SummaryHandler",function(){return l}),r.d(t,"InlineHandler",function(){return n}),r.d(t,"InlineStrategy",function(){return o})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),s=r(4),n=function(){function e(){}return e.handleValidation=function(e,t,r,n){var o=i.BindingHelper.getValidationGroup(n),a=i.BindingHelper.getViewOptions(n),l=s.ValidationState.unknown;n[i.BindingHelper.validationPropertyPathBindingName]=t;var u=s.ElementHelper.getViewStrategyFrom(e)||i.BindingHelper.getViewStrategy(n),h=s.ElementHelper.getPropertyRouteFrom(e);if(o&&"none"!=u){h&&(t=h);var c=s.viewStrategyRegistry.getStrategyNamed(u),d=function(){o.getPropertyError(t,!0)};o.propertyStateChangedEvent.subscribe(function(r){!function(r){r?(c.propertyBecomeInvalid(e,r,t,l,a),l=s.ValidationState.invalid):(c.propertyBecomeValid(e,t,l,a),l=s.ValidationState.valid)}(r.error)},function(e){return e.property==t}),r&&r.subscribe(d),a.immediateErrors&&d()}},e}();t.ValidationHandler=n},function(e,t,r){"use strict";r.r(t);function i(e,t,r,i){return new(r||(r=Promise))(function(s,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function a(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,a)}l((i=i.apply(e,t||[])).next())})}class s extends Error{constructor(e){super(e),this.message=e}}class n{constructor(e,t){this.ruleRegistry=e,this.localeHandler=t,this.processRuleLink=((e,t,r)=>i(this,void 0,void 0,function*(){if(!(!0===r.appliesIf||"function"==typeof r.appliesIf&&r.appliesIf(e,t,r.ruleOptions)))return;const i=this.ruleRegistry.getRuleNamed(r.ruleName);if(!i)throw new s(`No validator can be found for rule [${r.ruleName}]`);const n="function"==typeof r.ruleOptions?r.ruleOptions():r.ruleOptions;if(yield i.validate(e,t,n))return;let o;throw o=r.messageOverride?"function"==typeof r.messageOverride?r.messageOverride(e,t,r.ruleOptions):r.messageOverride:yield this.localeHandler.getMessage(r.ruleName,r.ruleOptions,e,t),new s(o)})),this.checkFieldForErrors=((e,t,r)=>i(this,void 0,void 0,function*(){const i=r=>this.processRuleLink(e,t,r);return Promise.resolve(r).then(e=>{const t=[];return e.forEach(e=>{t.push(i(e))}),Promise.all(t)}).then(function(){return null}).catch(e=>e.message)}))}}var o=r(3);class a{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.isPropertyRoute=(e=>e.indexOf(".")>=0),this.isIndexRoute=(e=>e.indexOf("[")>=0),this.resolvePropertyRules=((e,t)=>{const r=this.propertyResolver.decomposePropertyRoute(e),i=r[r.length-1],s=this.traverseRulesForRoutes(r,t);return s?s.getRulesForProperty?s.getRulesForProperty(i):s:null}),this.getMatchingRuleForProperty=((e,t)=>{let r;for(let i=0;i<t.length;i++)if((r=t[i]).isForEach&&(r=r.internalRule),r.getRulesForProperty&&r.rules[e])return r}),this.traverseRulesForRoutes=((e,t)=>{const r=e.shift();let i=t;if(t.rules&&(i=i.rules[r]),!i)return null;if(0==e.length)return i;const s=e[0];if(!s)return t;if(this.isIndexRoute(s)){e.shift();const t=[];if(i.forEach(e=>{e.isForEach&&t.push(e.internalRule)}),e.length>0){const r=[];return t.forEach(t=>{const i=e.slice();this.traverseRulesForRoutes(i,t).forEach(e=>{r.push(e)})}),r}return t}if(0==e.length)return i;const n=this.getMatchingRuleForProperty(s,i);return e.length>0?this.traverseRulesForRoutes(e,n):n})}}class l{static isDateType(e){return"function"==typeof e.getMonth}static isFunctionType(e){return"function"==typeof e}static isSimpleType(e){return"string"==typeof e||"number"==typeof e}static isArrayType(e){return"[object Array]"===Object.prototype.toString.call(e)}static isEmptyValue(e){return void 0===e||null===e||0==e.length}static isObjectOrArray(e){return!!e&&(e.constructor===Array||e.constructor===Object)}static isRuleset(e){return"function"==typeof e.addRule}static isForEach(e){return e.isForEach}}class u{constructor(){this.promiseCallbacks=[],this.validationCounter=0,this.waitForCompletion=(()=>i(this,void 0,void 0,function*(){if(!this.validationCounter)return;return new Promise(e=>{this.promiseCallbacks.push(()=>e())})})),this.countPromise=(e=>i(this,void 0,void 0,function*(){if(!e)return;if(!e.then)throw new Error("Non-Promise pass in: "+e);this.incrementCounter();const t=yield e;return this.decrementCounter(),t})),this.decrementCounter=(()=>{if(this.validationCounter--,!this.validationCounter)for(;this.promiseCallbacks.length;)this.promiseCallbacks.shift()()}),this.incrementCounter=(()=>{this.validationCounter++})}}class h{constructor(e,t,r){this.property=e,this.isValid=t,this.error=r}}class c{constructor(e){this.isValid=e}}var d=r(2);class p{constructor(){this.propertySanitizerRegex=/\[(.*?)]/g,this.propertyNameOverrideCache={},this.recurseTree=((e,t)=>{for(const r in e.rules){const i=this.updateRouteName(t,r);e.rules[r].forEach(e=>{l.isForEach(e)&&l.isRuleset(e.internalRule)&&this.recurseTree(e.internalRule,i),l.isRuleset(e)&&this.recurseTree(e,i)})}if(0!=Object.keys(e.propertyDisplayNames).length)for(const r in e.propertyDisplayNames){const i=this.updateRouteName(t,r);this.propertyNameOverrideCache[i]=e.propertyDisplayNames[r]}}),this.updateRouteName=((e,t)=>e.length>0?`${e}.${t}`:t),this.cacheDisplayNamesFor=(e=>{this.recurseTree(e,"")}),this.getDisplayNameFor=(e=>{const t=e.replace(this.propertySanitizerRegex,"");return this.propertyNameOverrideCache[t]||e})}}class y{constructor(e,t=new a,r,s,n,o){this.fieldErrorProcessor=e,this.ruleResolver=t,this.modelResolverFactory=r,this.localeHandler=s,this.ruleset=o,this.propertyErrors={},this.validatePropertyWithRuleLinks=((e,t)=>i(this,void 0,void 0,function*(){const r=this.fieldErrorProcessor.checkFieldForErrors(this.modelResolver,e,t),i=yield this.promiseCounter.countPromise(r),s=this.hasErrors();if(!i){if(this.propertyErrors[e]){delete this.propertyErrors[e];const t=new h(e,!0);this.propertyStateChangedEvent.publish(t),s&&this.hasErrors()||this.modelStateChangedEvent.publish(new c(!0))}return this.promiseCounter.waitForCompletion()}const n=this.propertyErrors[e];if(this.propertyErrors[e]=i,i!=n){const t=new h(e,!1,i);this.propertyStateChangedEvent.publish(t),s||this.modelStateChangedEvent.publish(new c(!1))}return this.promiseCounter.waitForCompletion()})),this.validatePropertyWithRuleSet=((e,t)=>{let r;for(const i in t.rules)r=`${e}.${i}`,this.validatePropertyWithRules(r,t.getRulesForProperty(i))}),this.validatePropertyWithRules=((e,t)=>{const r=[],i=[];let s;try{s=this.modelResolver.resolve(e)}catch(t){throw console.warn(`Failed to resolve property ${e} during validation. Does it exist in your model?`),t}t.forEach(t=>{l.isForEach(t)?l.isArrayType(s)?s.forEach((r,i)=>{const s=`${e}[${i}]`;this.validatePropertyWithRules(s,[t.internalRule])}):l.isRuleset(t.internalRule)?i.push(t.internalRule):r.push(t.internalRule):l.isRuleset(t)?i.push(t):r.push(t)}),this.validatePropertyWithRuleLinks(e,r),i.forEach(t=>{this.validatePropertyWithRuleSet(e,t)})}),this.startValidateProperty=(e=>i(this,void 0,void 0,function*(){if(Object.keys(this.ruleset.compositeRules).length>0&&(yield this.validateCompositeRules()),void 0!==this.ruleset.compositeRules[e])return;const t=this.ruleResolver.resolvePropertyRules(e,this.ruleset);return t?this.validatePropertyWithRules(e,t):void 0})),this.validateCompositeRule=(e=>i(this,void 0,void 0,function*(){const t=this.hasErrors();if(yield e.validate(this.modelResolver)){if(this.propertyErrors[e.virtualPropertyName]){delete this.propertyErrors[e.virtualPropertyName];const t=new h(e.virtualPropertyName,!0);this.propertyStateChangedEvent.publish(t)}return void(t&&this.hasErrors()||this.modelStateChangedEvent.publish(new c(!0)))}const r=this.propertyErrors[e.virtualPropertyName],i=yield this.localeHandler.getMessage(e.virtualPropertyName,e,this.modelResolver,null);if(this.propertyErrors[e.virtualPropertyName]=i,i!=r){const r=new h(e.virtualPropertyName,!1,i);this.propertyStateChangedEvent.publish(r),t||this.modelStateChangedEvent.publish(new c(!1))}return this.propertyErrors[e.virtualPropertyName]})),this.validateCompositeRules=(()=>i(this,void 0,void 0,function*(){for(const e in this.ruleset.compositeRules){const t=this.ruleset.compositeRules[e];yield this.validateCompositeRule(t)}})),this.startValidateModel=(()=>i(this,void 0,void 0,function*(){for(const e in this.ruleset.rules)yield this.startValidateProperty(e)})),this.changeValidationTarget=(e=>{this.modelResolver=this.modelResolverFactory.createModelResolver(e)}),this.validateProperty=(e=>i(this,void 0,void 0,function*(){return yield this.startValidateProperty(e),yield this.promiseCounter.waitForCompletion(),!this.propertyErrors[e]})),this.validate=(()=>i(this,void 0,void 0,function*(){return yield this.startValidateModel(),yield this.promiseCounter.waitForCompletion(),!this.hasErrors()})),this.getModelErrors=((e=!1)=>i(this,void 0,void 0,function*(){return e&&(yield this.startValidateModel()),yield this.promiseCounter.waitForCompletion(),this.propertyErrors})),this.getPropertyError=((e,t=!1)=>i(this,void 0,void 0,function*(){return t&&(yield this.startValidateProperty(e)),yield this.promiseCounter.waitForCompletion(),this.propertyErrors[e]})),this.getPropertyDisplayName=(e=>this.displayNameCache.getDisplayNameFor(e)),this.isPropertyInGroup=(e=>{return null!=this.ruleResolver.resolvePropertyRules(e,this.ruleset)}),this.release=(()=>{}),this.propertyStateChangedEvent=new d.EventHandler(this),this.modelStateChangedEvent=new d.EventHandler(this),this.displayNameCache=new p,this.promiseCounter=new u,this.modelResolver=this.modelResolverFactory.createModelResolver(n),this.displayNameCache.cacheDisplayNamesFor(o)}hasErrors(){return Object.keys(this.propertyErrors).length>0}}class v extends y{constructor(e,t=new a,r,i,s,n,o,l=500){super(e,t,r,s,n,o),this.modelWatcherFactory=i,this.localeHandler=s,this.refreshRate=l,this.onModelChanged=(e=>{this.startValidateProperty(e.propertyPath)}),this.release=(()=>{this.modelWatcher&&this.modelWatcher.stopWatching()}),this.modelWatcher=this.modelWatcherFactory.createModelWatcher(),this.modelWatcher.setupWatcher(n,o,l),this.modelWatcher.onPropertyChanged.subscribe(this.onModelChanged)}}class m{constructor(e,t){this.propertyPath=e,this.previousValue=t}}class f{constructor(e,t,r){this.propertyPath=e,this.newValue=t,this.oldValue=r}}class g{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.watchCache=[],this.watchCacheKeys=[],this.watcherInterval=null,this.setupWatcher=((e,t,r=500)=>{this.model=e,this.ruleset=t,this.scanInterval=r,this.watchCache=[],this.watchCacheKeys=[],this.cacheWatchTargets("",this.ruleset),this.scanProperties(),this.startWatching()}),this.changeWatcherTarget=(e=>{this.model=e,this.scanProperties()}),this.startWatching=(()=>{this.stopWatching(),this.watcherInterval=setInterval(this.scanProperties,this.scanInterval)}),this.stopWatching=(()=>{this.watcherInterval&&clearInterval(this.watcherInterval)}),this.updateAndNotifyDifferences=(()=>{const e=this.watchCacheKeys,t=this.watchCache;this.watchCache=[],this.watchCacheKeys=[],this.cacheWatchTargets("",this.ruleset),this.watchCacheKeys.forEach((r,i)=>{let s;if(-1==e.indexOf(r)){s=this.watchCache[i].previousValue;const e=new f(r,s,null);setTimeout(()=>{this.onPropertyChanged.publish(e)},1)}else if(t[i].previousValue&&t[i].previousValue.isArray&&t[i].previousValue.length!=this.watchCache[i].previousValue.length){const e=this.watchCache[i].previousValue;s=t[i].previousValue;const n=new f(r,e,s);setTimeout(()=>{this.onPropertyChanged.publish(n)},1)}})}),this.watchProperty=((e,t)=>{if(-1==this.watchCacheKeys.indexOf(e)){const r=new m(e,t);this.watchCache.push(r),this.watchCacheKeys.push(e)}}),this.cacheWatchTargets=((e,t)=>{let r,i,s,n,o,a;for(const u in t.rules){r=e?e+"."+u:u,i=t.rules[u],s=!1,n=!1,i.forEach(function(e){e.isForEach&&(s=!0),e.getRulesForProperty&&(n=!0)}),o=!1;try{a=this.propertyResolver.resolveProperty(this.model,r),o=!0}catch(e){}null==a&&(s||n)&&(a=s?[]:n?{}:null),i.forEach(e=>{const t=l.isArrayType(a);if(t){const e={length:a.length,isArray:!0};this.watchProperty(r,e)}e.isForEach&&o?e.internalRule.getRulesForProperty?this.model[u]&&this.model[u].forEach((t,i)=>{this.cacheWatchTargets(r+"["+i+"]",e.internalRule)}):this.model[u]&&this.model[u].forEach((e,t)=>{this.watchProperty(r+"["+t+"]",this.model[u][t])}):e.getRulesForProperty?this.cacheWatchTargets(r,e):t||this.watchProperty(r,a)})}}),this.scanProperties=(()=>{if(0==this.onPropertyChanged.getSubscriptionCount())return;if(0==this.watchCache.length)return;let e=!1;this.watchCache.forEach(t=>{let r,i=!1;try{r=this.propertyResolver.resolveProperty(this.model,t.propertyPath)}catch(e){}if(void 0===r&&(r=t.previousValue),t.previousValue&&t.previousValue.isArray){(r.length||0)!=t.previousValue.length&&(i=!0)}else if(r!==t.previousValue){const e=new f(t.propertyPath,r,t.previousValue);setTimeout(()=>{this.onPropertyChanged.publish(e)},1),t.previousValue=r}i&&(e=!0)}),e&&setTimeout(this.updateAndNotifyDifferences,1)}),this.onPropertyChanged=new d.EventHandler(this)}}class R{constructor(){this.createModelWatcher=(()=>new g)}}class w{constructor(e,t){this.propertyResolver=e,this.model=t}resolve(e){return this.propertyResolver.resolveProperty(this.model,e)}}class P{constructor(e=new o.PropertyResolver){this.propertyResolver=e,this.createModelResolver=(e=>new w(this.propertyResolver,e))}}class E{constructor(e,t,r){this.fieldErrorProcessor=e,this.ruleResolver=t,this.localeHandler=r,this.create=(()=>(this.refreshRate=500,this.validateOnStart=!1,this.modelWatcherFactory=new R,this.modelResolverFactory=new P,this)),this.withRefreshRate=(e=>(this.refreshRate=e,this)),this.withModelResolverFactory=(e=>(this.modelResolverFactory=e,this)),this.withModelWatcherFactory=(e=>(this.modelWatcherFactory=e,this)),this.andValidateOnStart=(()=>(this.validateOnStart=!0,this)),this.build=((e,t)=>{const r=new v(this.fieldErrorProcessor,this.ruleResolver,this.modelResolverFactory,this.modelWatcherFactory,this.localeHandler,e,t,this.refreshRate);return this.validateOnStart&&r.validate(),r})}}class F{constructor(e,t,r){this.fieldErrorProcessor=e,this.ruleResolver=t,this.localeHandler=r,this.create=(()=>(this.modelResolverFactory=new P,this.validateOnStart=!1,this)),this.asReactiveGroup=(()=>{return new E(this.fieldErrorProcessor,this.ruleResolver,this.localeHandler).create().withModelResolverFactory(this.modelResolverFactory)}),this.withModelResolverFactory=(e=>(this.modelResolverFactory=e,this)),this.andValidateOnStart=(()=>(this.validateOnStart=!0,this)),this.build=((e,t)=>{const r=new y(this.fieldErrorProcessor,this.ruleResolver,this.modelResolverFactory,this.localeHandler,e,t);return this.validateOnStart&&r.validate(),r})}}class C{constructor(){this.rules={},this.registerRule=(e=>{this.rules[e.ruleName]=e}),this.unregisterRule=(e=>{delete this.rules[e.ruleName]}),this.getRuleNamed=(e=>this.rules[e]||null),this.hasRuleNamed=(e=>null!=this.getRuleNamed(e))}}class b{constructor(){this.ruleName="date",this.invalidObjectRegex=/Invalid|NaN/}validate(e,t){return i(this,void 0,void 0,function*(){const r=e.resolve(t);return!!l.isEmptyValue(r)||!this.invalidObjectRegex.test(new Date(r))})}}class x{constructor(){this.ruleName="decimal",this.decimalRegex=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/}validate(e,t){return i(this,void 0,void 0,function*(){const r=e.resolve(t);return!!l.isEmptyValue(r)||this.decimalRegex.test(r)})}}class N{constructor(){this.ruleName="email",this.emailRegex=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/}validate(e,t){return i(this,void 0,void 0,function*(){const r=e.resolve(t);return!!l.isEmptyValue(r)||this.emailRegex.test(r)})}}class V{static simpleTypeComparer(e,t,r){return r?e==t:e===t}static dateTimeCompararer(e,t){return e.getTime()==t.getTime()}}class S{constructor(){this.ruleName="equal"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);if(l.isEmptyValue(i))return!0;let s=r.value||r;const n=r.weakEquality||!1;return l.isFunctionType(s)&&(s=s()),l.isDateType(s)?V.dateTimeCompararer(i,s):V.simpleTypeComparer(i,s,n)})}}class O{constructor(){this.ruleName="isoDate",this.isoDateRegex=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/}validate(e,t){return i(this,void 0,void 0,function*(){const r=e.resolve(t);return!!l.isEmptyValue(r)||this.isoDateRegex.test(r)})}}class T{constructor(){this.ruleName="maxLength"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);return!!l.isEmptyValue(i)||i.length<=r})}}class D{constructor(){this.ruleName="maxValue"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);return!!l.isEmptyValue(i)||i<=r})}}class H{constructor(){this.ruleName="minLength"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);return!!l.isEmptyValue(i)||i.length>=r})}}class M{constructor(){this.ruleName="minValue"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);return!!l.isEmptyValue(i)||i>=r})}}class ${constructor(){this.ruleName="notEqual"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);if(l.isEmptyValue(i))return!0;let s=r.value||r;const n=r.weakEquality||!1;return l.isFunctionType(s)&&(s=s()),l.isDateType(s)?!V.dateTimeCompararer(i,s):!V.simpleTypeComparer(i,s,n)})}}class A{constructor(){this.ruleName="number",this.numberRegex=/^\d+$/}validate(e,t){return i(this,void 0,void 0,function*(){const r=e.resolve(t);return!!l.isEmptyValue(r)||this.numberRegex.test(r)})}}class W{constructor(){this.ruleName="regex"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);return!!l.isEmptyValue(i)||null!==i.toString().match(r)})}}class B{constructor(){this.ruleName="required"}validate(e,t,r=!0){return i(this,void 0,void 0,function*(){const i=e.resolve(t);if(void 0===i||null===i)return!r;let s=i;return"string"==typeof s&&(s=String.prototype.trim?i.trim():i.replace(/^\s+|\s+$/g,"")),!r||(s+"").length>0})}}class I{constructor(){this.ruleName="step"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=e.resolve(t);if(l.isEmptyValue(i))return!0;const s=100*i%(100*r);return Math.abs(s)<1e-5||Math.abs(1-s)<1e-5})}}class j{constructor(){this.ruleName="matches"}validate(e,t,r){return i(this,void 0,void 0,function*(){const i=r.property||r,s=r.weakEquality||!1,n=e.resolve(t),o=e.resolve(i);return void 0===n||null===n?void 0===o||null===o:l.isDateType(n)?V.dateTimeCompararer(n,o):V.simpleTypeComparer(n,o,s)})}}let _;_||((_=new C).registerRule(new b),_.registerRule(new x),_.registerRule(new N),_.registerRule(new S),_.registerRule(new O),_.registerRule(new T),_.registerRule(new D),_.registerRule(new H),_.registerRule(new M),_.registerRule(new $),_.registerRule(new A),_.registerRule(new W),_.registerRule(new B),_.registerRule(new I),_.registerRule(new j));class k{constructor(){this.rules={},this.compositeRules={},this.propertyDisplayNames={},this.createPropertyEntryIfNeeded=(e=>{this.rules[e]||(this.rules[e]=[])}),this.addRule=((e,t)=>{this.createPropertyEntryIfNeeded(e),this.rules[e].push(t)}),this.addRuleset=((e,t)=>{this.createPropertyEntryIfNeeded(e),this.rules[e].push(t)}),this.addCompositeRule=(e=>{this.compositeRules[e.virtualPropertyName]=e}),this.addPropertyDisplayName=((e,t)=>this.propertyDisplayNames[e]=t),this.getRulesForProperty=(e=>this.rules[e]),this.getCompositeRulesRulesForProperty=(e=>this.compositeRules[e])}}class L{constructor(e,t){this.ruleName=e,this.ruleOptions=t,this.appliesIf=!0}}class q{constructor(e){this.internalRule=e,this.isForEach=!0}}class K{constructor(e,t){this.virtualPropertyName=e,this.validate=t}}class G{constructor(e){this.ruleRegistry=e,this.verifyExistingProperty=(()=>{if(!this.currentProperty)throw new Error("A property must precede any rule calls in the chain")}),this.verifyRuleNameIsValid=(e=>{if(null==e||void 0===e||0==e.length)throw new Error("A rule name is required");if(this.ruleRegistry&&!this.ruleRegistry.hasRuleNamed(e))throw new Error(`The rule [${e}] has not been registered`)}),this.create=(e=>(this.internalRuleset=e||new k,this.currentProperty=null,this)),this.mergeInRuleset=(e=>(this.internalRuleset.rules=Object.assign({},this.internalRuleset.rules,e.rules),this.internalRuleset.compositeRules=Object.assign({},this.internalRuleset.compositeRules,e.compositeRules),this.internalRuleset.propertyDisplayNames=Object.assign({},this.internalRuleset.propertyDisplayNames,e.propertyDisplayNames),this)),this.forProperty=(e=>{let t=e;if(l.isFunctionType(t)&&!(t=this.extractPropertyName(e)))throw new Error(`cannot resolve property from: ${e}`);return this.currentProperty=t,this.currentRule=null,this}),this.then=(e=>{this.verifyExistingProperty();const t=(new G).create();e(t);const r=t.build();return this.addRuleset(r)}),this.thenForEach=(e=>{this.verifyExistingProperty();const t=(new G).create();e(t);const r=t.build();return this.addRulesetForEach(r)}),this.addRule=((e,t)=>(this.verifyRuleNameIsValid(e),this.verifyExistingProperty(),this.internalRuleset.addRule(this.currentProperty,this.currentRule=new L(e,t)),this)),this.addCompositeRule=(e=>(this.internalRuleset.compositeRules[e.virtualPropertyName]=e,this)),this.withDisplayName=(e=>(this.verifyExistingProperty(),this.internalRuleset.propertyDisplayNames[this.currentProperty]=e,this)),this.addDynamicRule=((e,t)=>{const r=new K(e,t);return this.internalRuleset.compositeRules[e]=r,this}),this.withMessage=(e=>(this.verifyExistingProperty(),this.currentRule.messageOverride=e,this)),this.appliesIf=(e=>(this.verifyExistingProperty(),this.currentRule.appliesIf=e,this)),this.addRuleForEach=((e,t)=>{this.verifyRuleNameIsValid(e),this.verifyExistingProperty();const r=new L(e,t);return this.currentRule=r,this.internalRuleset.addRule(this.currentProperty,new q(r)),this}),this.addRuleset=(e=>(this.verifyExistingProperty(),this.internalRuleset.addRuleset(this.currentProperty,e),this)),this.addRulesetForEach=(e=>(this.verifyExistingProperty(),this.internalRuleset.addRuleset(this.currentProperty,new q(e)),this)),this.build=(()=>this.internalRuleset),this.required=(()=>this.addRule("required")),this.date=(()=>this.addRule("date")),this.decimal=(()=>this.addRule("decimal")),this.email=(()=>this.addRule("email")),this.isoDate=(()=>this.addRule("isoDate")),this.number=(()=>this.addRule("number")),this.equal=(e=>this.addRule("equal",e)),this.notEqual=(e=>this.addRule("notEqual",e)),this.minValue=(e=>this.addRule("minValue",e)),this.maxValue=(e=>this.addRule("maxValue",e)),this.minLength=(e=>this.addRule("minLength",e)),this.maxLength=(e=>this.addRule("maxLength",e)),this.regex=(e=>this.addRule("regex",e)),this.step=(e=>this.addRule("step",e)),this.matches=(e=>{let t=e;if(l.isFunctionType(t)&&!(t=this.extractPropertyName(e)))throw new Error(`cannot resolve property from: ${e}`);return this.addRule("matches",t)})}extractPropertyName(e){const t=e.toString();return/.*\.([\w]*)/.exec(t)[1]}static create(e){return(new G).create(e)}}class z{constructor(){this.localeResources={},this.getCurrentLocale=(()=>this.localeCode),this.registerLocale=((e,t)=>i(this,void 0,void 0,function*(){this.localeCode=e,this.localeResources[this.localeCode]=t})),this.useLocale=(e=>i(this,void 0,void 0,function*(){if(!this.localeResources[e])throw`Unable to find registered locale for [${e}]`;this.localeCode=e})),this.supplementLocaleFrom=((e,t)=>i(this,void 0,void 0,function*(){this.localeResources[e]||(this.localeResources[e]={});for(const r in t)this.localeResources[e][r]=t[r]})),this.getMessage=((e,t,r,s)=>i(this,void 0,void 0,function*(){const i=this.localeResources[this.localeCode],n=i[e]||i.default||`Cannot find rule for ${e}`;return"string"==typeof n?n:3===n.length||null==s?n(r,s,t):n(r.resolve(s),t)}))}}const J={default:"This field is invalid",required:"This field is required",date:e=>`This field contains "${e}" which is not a valid date`,decimal:e=>`This field contains ${e} which is not a decimal value`,equal:(e,t)=>`This field is ${e} but should be equal to ${t.value||t}`,notEqual:(e,t)=>`This field is ${e} but should not be equal to ${t.value||t}`,isoDate:e=>`This field contains "${e}" which is not a valid ISO date`,maxLength:(e,t)=>`This field has a length of ${e.length} but should contain no more than ${t}`,minLength:(e,t)=>`This field has a length of ${e.length} but should more than ${t}`,maxValue:(e,t)=>`This field has a value of ${e} but should be less than or equal to ${t}`,minValue:(e,t)=>`This field has a value of ${e} but should be greater than or equal to ${t}`,number:e=>`This field contains ${e} which is not a numeric value`,regex:"This field does not match the expected format",step:(e,t)=>`This field has a value of ${e} and should be an increment of ${t}`,matches:(e,t,r)=>{const i=e.resolve(t),s=r.property||r;return`This field is ${i} but should match ${e.resolve(s)}`}},Z=new z;Z.registerLocale("en-us",J),Z.useLocale("en-us");const U=new n(_,Z),Q=new a;function X(e,t=!1){return(t?new G(_):new G).create(e)}function Y(e,t){const r=new k;return r.rules=Object.assign({},e.rules,t.rules),r.compositeRules=Object.assign({},e.compositeRules,t.compositeRules),r.propertyDisplayNames=Object.assign({},e.propertyDisplayNames,t.propertyDisplayNames),r}function ee(){return new F(U,Q,Z).create()}const te=Z;function re(e,t){Z.supplementLocaleFrom(e,t)}class ie{constructor(e,t){this.propertyName=e,this.message=t}}class se{constructor(){this.proxyObject=((e,t)=>this.walkModelAndProxy(e,null,t)),this.createHandler=(e=>{const t=this.onPropertyChanged;return{set:function(r,i,s){const n=r[i];if(n!==s){Reflect.set(r,i,s);const o=new f(e,s,n);setTimeout(()=>{t.publish(o)},1)}return!0},get:function(e,t){return Reflect.get(e,t)}}}),this.proxyProperty=((e,t)=>new Proxy(e,this.createHandler(t))),this.walkModelAndProxy=((e,t,r)=>{let i,s;for(const n in r.rules){i=t?t+"."+n:n;let o=!1,a=!1;(s=r.rules[n]).forEach(t=>{const r=e[n];(o=t.isForEach)?r.forEach((e,s)=>{t.internalRule.getRulesForProperty&&(r[s]=this.walkModelAndProxy(e,`${i}[${s}]`,t.internalRule))}):t.getRulesForProperty&&(a=!0,e[n]=this.walkModelAndProxy(r,i,t))}),(o||a)&&(e[n]=this.proxyProperty(e[n],i))}return this.proxyProperty(e,t)}),this.onPropertyChanged=new d.EventHandler(this)}}class ne{constructor(e,t){if(!e||0==e.length)throw new Error("ruleName is required, an empty rule name is invalid");if(!t||0==t.length)throw new Error("expression is required, an empty regex expression is invalid");this.ruleName=e,this.expression=t}validate(e,t,r){return i(this,void 0,void 0,function*(){const r=e.resolve(t);return!!l.isEmptyValue(r)||null!==r.toString().match(this.expression)})}}r.d(t,"createRuleset",function(){return X}),r.d(t,"mergeRulesets",function(){return Y}),r.d(t,"createGroup",function(){return ee}),r.d(t,"localeHandler",function(){return te}),r.d(t,"supplementLocale",function(){return re}),r.d(t,"ruleRegistry",function(){return _}),r.d(t,"ReactiveValidationGroupBuilder",function(){return E}),r.d(t,"RulesetBuilder",function(){return G}),r.d(t,"ValidationGroupBuilder",function(){return F}),r.d(t,"ModelStateChangedEvent",function(){return c}),r.d(t,"PropertyChangedEvent",function(){return f}),r.d(t,"PropertyStateChangedEvent",function(){return h}),r.d(t,"ComparerHelper",function(){return V}),r.d(t,"TypeHelper",function(){return l}),r.d(t,"ModelResolverFactory",function(){return P}),r.d(t,"ModelWatcherFactory",function(){return R}),r.d(t,"locale",function(){return J}),r.d(t,"DefaultLocaleHandler",function(){return z}),r.d(t,"FieldErrorProcessor",function(){return n}),r.d(t,"FieldHasError",function(){return s}),r.d(t,"ValidationError",function(){return ie}),r.d(t,"PromiseCounter",function(){return u}),r.d(t,"ModelProxy",function(){return se}),r.d(t,"ModelResolver",function(){return w}),r.d(t,"AdvancedRegexValidationRule",function(){return ne}),r.d(t,"DateValidationRule",function(){return b}),r.d(t,"DecimalValidationRule",function(){return x}),r.d(t,"EmailValidationRule",function(){return N}),r.d(t,"EqualValidationRule",function(){return S}),r.d(t,"ISODateValidationRule",function(){return O}),r.d(t,"MatchesValidationRule",function(){return j}),r.d(t,"MaxLengthValidationRule",function(){return T}),r.d(t,"MaxValueValidationRule",function(){return D}),r.d(t,"MinLengthValidationRule",function(){return H}),r.d(t,"MinValueValidationRule",function(){return M}),r.d(t,"NotEqualValidationRule",function(){return $}),r.d(t,"NumberValidationRule",function(){return A}),r.d(t,"RegexValidationRule",function(){return W}),r.d(t,"RequiredValidationRule",function(){return B}),r.d(t,"RuleRegistry",function(){return C}),r.d(t,"StepValidationRule",function(){return I}),r.d(t,"ForEachRule",function(){return q}),r.d(t,"RuleLink",function(){return L}),r.d(t,"RuleResolver",function(){return a}),r.d(t,"Ruleset",function(){return k}),r.d(t,"DisplayNameCache",function(){return p}),r.d(t,"ReactiveValidationGroup",function(){return v}),r.d(t,"ValidationGroup",function(){return y}),r.d(t,"ModelWatcher",function(){return g}),r.d(t,"PropertyWatcher",function(){return m}),r.d(t,"DynamicCompositeValidationRule",function(){return K})},function(e,t){var r=function(){return function(e,t){this.callback=e,this.predicate=t}}();t.EventListener=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=function(){function e(){var e=this;this.indexRegex=/\[(\d)]/,this.splitRegex=/\./,this.resolveProperty=function(t,r){var s=null,n=[],o="";if("string"!=typeof r)throw new TypeError("propertyChain is not a string");return r.split(e.splitRegex).forEach(function(r){var a=-1;if(e.indexRegex.test(r)&&(a=e.indexRegex.exec(r)[1],r=r.replace(e.indexRegex,"")),s){if("object"!=typeof s)throw new TypeError('"'+s+'"  does not seem to be an object');if(a>=0){if(!(a<i.unwrap(s[r]).length))throw new TypeError('cannot find index "'+a+'" in '+o);n.push(s=i.unwrap(s[r])[a]),o=r[a]}else{if(!(r in s))throw new TypeError('cannot resolve "'+r+'" in '+o);n.push(s=i.unwrap(s[r])),o=r}}else a>=0?0==r.length?(n.push(s=i.unwrap(t)[a]),o=a):(n.push(s=i.unwrap(t[r])[a]),o=r[a]):(o=r,n.push(s=i.unwrap(t[r])))}),i.unwrap(n[n.length-1])}}return e.prototype.decomposePropertyRoute=function(e){for(var t,r=[],i=e.split(this.splitRegex),s=0;s<i.length;s++)this.indexRegex.test(i[s])?(t=this.indexRegex.exec(i[s])[1],r.push(i[s].replace(this.indexRegex,"")),r.push("["+t+"]")):r.push(i[s]);return r},e.prototype.getPropertyRouteSection=function(e,t){return void 0===t&&(t=0),this.decomposePropertyRoute(e)[t]},e.prototype.buildPropertyRoute=function(e){for(var t="",r=0;r<e.length;r++)0!=t.length?e[r].indexOf("[")>=0?t+=""+e[r]:t+="."+e[r]:t+=e[r];return t},e}();t.KnockoutPropertyResolver=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),s=function(){function e(e){this.propertyResolver=e}return e.prototype.createModelWatcher=function(){return new i.KnockoutModelWatcher(this.propertyResolver)},e}();t.KnockoutModelWatcherFactory=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(6),s=r(3),n=r(2),o=r(0),a=function(){return function(e){void 0===e&&(e=new s.PropertyResolver);var t=this;this.propertyResolver=e,this.watchCache=[],this.watchCacheKeys=[],this.watcherInterval=null,this.setupWatcher=function(e,r,i){void 0===i&&(i=500),t.model=e,t.ruleset=r,t.scanInterval=i,t.watchCache=[],t.watchCacheKeys=[],t.cacheWatchTargets("",t.ruleset),t.scanProperties(),t.startWatching()},this.changeWatcherTarget=function(e){t.model=e,t.scanProperties()},this.startWatching=function(){t.stopWatching(),t.watcherInterval=setInterval(t.scanProperties,t.scanInterval)},this.stopWatching=function(){t.watcherInterval&&clearInterval(t.watcherInterval)},this.updateAndNotifyDifferences=function(){var e=t.watchCacheKeys,r=t.watchCache;t.watchCache=[],t.watchCacheKeys=[],t.cacheWatchTargets("",t.ruleset),t.watchCacheKeys.forEach(function(s,n){if(-1==e.indexOf(s)){var o=t.watchCache[n].previousValue,a=new i.PropertyChangedEvent(s,o,null);setTimeout(function(){t.onPropertyChanged.publish(a)},1)}else if(r[n].previousValue&&r[n].previousValue.isArray&&r[n].previousValue.length!=t.watchCache[n].previousValue.length){var l=t.watchCache[n].previousValue;o=r[n].previousValue,a=new i.PropertyChangedEvent(s,l,o),setTimeout(function(){t.onPropertyChanged.publish(a)},1)}})},this.watchProperty=function(e,r){if(-1==t.watchCacheKeys.indexOf(e)){var s=new i.PropertyWatcher(e,r);t.watchCache.push(s),t.watchCacheKeys.push(e)}},this.cacheWatchTargets=function(e,r){var s,n,a,l,u,h;for(var c in r.rules){s=e?e+"."+c:c,n=r.rules[c],a=!1,l=!1,n.forEach(function(e){e.isForEach&&(a=!0),e.getRulesForProperty&&(l=!0)}),u=!1;try{var d=t.propertyResolver.resolveProperty(t.model,s);h=o.unwrap(d),u=!0}catch(e){}null==h&&(a||l)&&(h=a?[]:l?{}:null),n.forEach(function(e){var r=i.TypeHelper.isArrayType(h);if(r){var n={length:h.length,isArray:!0};t.watchProperty(s,n)}e.isForEach&&u?e.internalRule.getRulesForProperty?t.model[c]&&o.unwrap(t.model[c]).forEach(function(r,i){t.cacheWatchTargets(s+"["+i+"]",e.internalRule)}):t.model[c]&&o.unwrap(t.model[c]).forEach(function(e,r){t.watchProperty(s+"["+r+"]",o.unwrap(t.model[c])[r])}):e.getRulesForProperty?t.cacheWatchTargets(s,e):r||t.watchProperty(s,h)})}},this.scanProperties=function(){if(0!=t.onPropertyChanged.getSubscriptionCount()&&0!=t.watchCache.length){var e=!1;t.watchCache.forEach(function(r){var s,n=!1;try{var a=t.propertyResolver.resolveProperty(t.model,r.propertyPath);s=o.unwrap(a)}catch(e){}if(void 0===s&&(s=r.previousValue),r.previousValue&&r.previousValue.isArray)(s.length||0)!=r.previousValue.length&&(n=!0);else if(s!==r.previousValue){var l=new i.PropertyChangedEvent(r.propertyPath,s,r.previousValue);setTimeout(function(){t.onPropertyChanged.publish(l)},1),r.previousValue=s}n&&(e=!0)}),e&&setTimeout(t.updateAndNotifyDifferences,1)}},this.onPropertyChanged=new n.EventHandler(this)}}();t.KnockoutModelWatcher=a},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(12)),i(r(15)),i(r(16)),i(r(17)),i(r(5)),i(r(18)),i(r(1)),i(r(9)),i(r(10)),i(r(8)),i(r(19)),i(r(20)),i(r(21)),i(r(22))},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(6)),i(r(4));var s=r(6),n=r(8),o=r(9),a=new n.KnockoutPropertyResolver,l=new o.KnockoutModelWatcherFactory(a),u=new s.ModelResolverFactory(a);t.createGroup=function(){return s.createGroup().andValidateOnStart().asReactiveGroup().withModelResolverFactory(u).withModelWatcherFactory(l)}},function(e,t){var r=function(){function e(){var e=this;this.indexRegex=/\[(\d)]/,this.splitRegex=/\./,this.resolveProperty=function(t,r){var i=null,s=[],n="";if("string"!=typeof r)throw new TypeError("propertyChain is not a string");return r.split(e.splitRegex).forEach(function(r){var o=-1;if(e.indexRegex.test(r)&&(o=e.indexRegex.exec(r)[1],r=r.replace(e.indexRegex,"")),i){if("object"!=typeof i)throw new TypeError('"'+i+'"  does not seem to be an object');if(o>=0){if(!(o<i[r].length))throw new TypeError('cannot find index "'+o+'" in '+n);s.push(i=i[r][o]),n=r[o]}else{if(!(r in i))throw new TypeError('cannot resolve "'+r+'" in '+n);s.push(i=i[r]),n=r}}else o>=0?0==r.length?(s.push(i=t[o]),n=o):(s.push(i=t[r][o]),n=r[o]):(n=r,s.push(i=t[r]))}),s[s.length-1]}}return e.prototype.decomposePropertyRoute=function(e){for(var t,r=[],i=e.split(this.splitRegex),s=0;s<i.length;s++)this.indexRegex.test(i[s])?(t=this.indexRegex.exec(i[s])[1],r.push(i[s].replace(this.indexRegex,"")),r.push("["+t+"]")):r.push(i[s]);return r},e.prototype.getPropertyRouteSection=function(e,t){return void 0===t&&(t=0),this.decomposePropertyRoute(e)[t]},e.prototype.buildPropertyRoute=function(e){for(var t="",r=0;r<e.length;r++)0!=t.length?e[r].indexOf("[")>=0?t+=""+e[r]:t+="."+e[r]:t+=e[r];return t},e}();t.PropertyResolver=r},function(e,t,r){var i=r(7),s=function(){return function(e){var t=this;this.sender=e,this.listeners=[],this.subscribe=function(e,r){return t.listeners.push(new i.EventListener(e,r)),function(){t.unsubscribe(e)}},this.unsubscribe=function(e){for(var r=0;r<t.listeners.length;r++)if(t.listeners[r].callback==e)return void t.listeners.splice(r,1)},this.unsubscribeAll=function(){t.listeners=[]},this.publish=function(e){t.listeners.forEach(function(r){r.predicate?r.predicate(e)&&setTimeout(function(){r.callback(e,t.sender)},1):setTimeout(function(){r.callback(e,t.sender)},1)})},this.publishSync=function(e){t.listeners.forEach(function(r){r.predicate?r.predicate(e)&&r.callback(e,t.sender):r.callback(e,t.sender)})},this.getSubscriptionCount=function(){return t.listeners.length}}}();t.EventHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);i.bindingHandlers["enabled-with"]={init:function(e,t,r,s,n){var o=t(),a=Array.isArray(o);e.disabled=!0;var l=function(t){e.disabled=!t.isValid};a?o.forEach(function(e){e.modelStateChangedEvent.subscribe(l)}):o.modelStateChangedEvent.subscribe(l),i.utils.domNodeDisposal.addDisposeCallback(e,function(){a?o.forEach(function(e){e.modelStateChangedEvent.unsubscribe(l)}):o.modelStateChangedEvent.unsubscribe(l)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(5),n=r(4);i.bindingHandlers["show-error"]={init:function(e,t,r,i,o){var a=t();a||(a=n.ElementHelper.getPropertyRouteFrom(e)),a?s.ValidationHandler.handleValidation(e,a,t(),o):console.log("no valid property path in scope on element",e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(1),n=r(4);i.bindingHandlers["validate-with"]={init:function(e,t,r,i,o){var a=t(),l=n.ElementHelper.getViewStrategyFrom(e)||"inline",u=n.ElementHelper.getViewOptionsFrom(e)||{};o[s.BindingHelper.validationGroup]=a,o[s.BindingHelper.viewOptions]=u,o[s.BindingHelper.viewStrategy]=l}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(6),n=r(4),o=r(1),a=new n.DefaultViewSummary;i.bindingHandlers["validation-summary"]={init:function(e,t,r,n,l){var u=t();u||(u=o.BindingHelper.getValidationGroup(l));var h=o.BindingHelper.getViewOptions(l),c=Array.isArray(u);if(!!u.propertyStateChangedEvent){a.setupContainer(e);var d=function(t){var r=function(e){if(!c)return u.getPropertyDisplayName(e);var t=e;return u.forEach(function(r){var i=r.getPropertyDisplayName(e);i!=e&&(t=i)}),t}(t.property);t.isValid?a.propertyBecomeValid(e,r):a.propertyBecomeInvalid(e,t.error,r)},p=function(e){e.getModelErrors().then(function(e){Object.keys(e).forEach(function(t){var r=new s.PropertyStateChangedEvent(t,!1,e[t]);d(r)})})};c?u.forEach(function(e){e.propertyStateChangedEvent.subscribe(d),h.immediateErrors&&p(e)}):(u.propertyStateChangedEvent.subscribe(d),h.immediateErrors&&p(u)),i.utils.domNodeDisposal.addDisposeCallback(e,function(){c?u.forEach(function(e){e.propertyStateChangedEvent.unsubscribe(d)}):u.propertyStateChangedEvent.unsubscribe(d)})}else console.log("summary-for binding requires a reactive validation group",e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(1);i.bindingHandlers.foreach.preprocess=function(e,t,r){return r(s.BindingHelper.validationPropertyBindingName,"'"+e+"'"),e};var n=i.bindingHandlers.foreach.init;i.bindingHandlers.foreach.init=function(e,t,r,i,o){var a=r.get(s.BindingHelper.validationPropertyBindingName),l=s.BindingHelper.getCurrentPropertyPath(a,o);return o[s.BindingHelper.validationPropertyPathBindingName]=l,n(e,t,r,i,o)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(1),n=r(5);i.bindingHandlers.textInput.preprocess=function(e,t,r){return r(s.BindingHelper.validationPropertyBindingName,"'"+e+"'"),e};var o=i.bindingHandlers.textInput.init;i.bindingHandlers.textInput.init=function(e,t,r,i,a){var l=r.get(s.BindingHelper.validationPropertyBindingName),u=s.BindingHelper.getCurrentPropertyPath(l,a);return n.ValidationHandler.handleValidation(e,u,t(),a),o(e,t,r,i,a)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(1),n=r(5);i.bindingHandlers.value.preprocess=function(e,t,r){return r(s.BindingHelper.validationPropertyBindingName,"'"+e+"'"),e};var o=i.bindingHandlers.value.init;i.bindingHandlers.value.init=function(e,t,r,i,a){var l=r.get(s.BindingHelper.validationPropertyBindingName),u=s.BindingHelper.getCurrentPropertyPath(l,a);return n.ValidationHandler.handleValidation(e,u,t(),a),o(e,t,r,i,a)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(1);i.bindingHandlers.with.preprocess=function(e,t,r){return r(s.BindingHelper.validationPropertyBindingName,"'"+e+"'"),e};var n=i.bindingHandlers.with.init;i.bindingHandlers.with.init=function(e,t,r,i,o){var a=r.get(s.BindingHelper.validationPropertyBindingName),l=s.BindingHelper.getCurrentPropertyPath(a,o);return o[s.BindingHelper.validationPropertyPathBindingName]=l,n(e,t,r,i,o)}}])});